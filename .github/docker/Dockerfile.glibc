ARG NODE_BUILD_IMAGE=node:16.20.1-bullseye
FROM $NODE_BUILD_IMAGE AS build

WORKDIR /kerberos
COPY . .

RUN npm clean-install --ignore-scripts && \
    aptitude install krb5-user && \
    npm run test

FROM scratch

COPY --from=build /kerberos/prebuilds/ /